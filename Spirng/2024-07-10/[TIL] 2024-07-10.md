# [TIL] 2024-07-10

## 모든 것이 HTTP
- HTTP 메시지에 모든 것을 전송한다.
- html, txt, 음성, 이미지 등등


## 웹서버
- HTTP 기반 동작
- 정적 리소스 제공, 기타 부가기능
- 정적(파일) HTML, CSS, JS, 이미지, 영상
- 예) nginx, Apache

## WAS
- HTTP 기반 동작
- 웹 서버 기능 포함 + (정적 리소스 제공 가능)
- 프로그램 코드를 실행해서 애플리케이션 로직 수행 -> 사용자마다 다른 화면을 보여줄 수 있다.
    - 동적 HTML, HTTP API(REST)
    - 서블릿, JSP, 스프링MVC
- 예) 톰캣, Jetty

## 차이
- 웹 서버는 정적 리소스(파일), WAS는 애플리케이션 로직
- 경계는 사실 모호함
    - 웹 서버도 프로그램 실행 기능을 포함하기도 함
- 자바는 서블릿 컨테이너 기능을 제공하면 WAS
    - 서블릿 없이 자바 코드를 실행하는 서버 프레임워크도 있다
- WAS는 애플리케이션 코드를 실행하는데 더 특화
- WAS는 정적 리소스, 애플리케이션 로직 모두 제공 가능하다.

## 웹 시스템 구성 - WEB, WAS, DB
- 정적 리소스는 웹 서버가 처리
- 웹서버는 동적 처리가 필요하면 WAS에 요청 위임
- WAS는 중요한 애플리케이션 로직 처리를 전담 할 수 있다.
- 효율적인 리소스 관리
    - 정적 리소스가 많이 사용 -> Web 서버 증설
    - 애플리케이션 리소스가 많이 사용 -> WAS 서버 증설
- 웹 서버는 잘 죽지 않음 -> WAS, DB 장애시 WEB 서버가 오류 화면을 제공할 수 있다.

## 서블릿
- WAS에서 의미있는 비즈니스 로직을 제외한 전,후의 모든 부분을 대신 처리해준다.
- 서블릿 컨테이너는 객체 생성, 초기화, 호출, 종료하는 생명주기 관리
- 서블릿 객체는 싱글톤으로 관리한다.
    - 사용자의 모든 요청은 동일한 서블릿 객체 인스턴스에 접근한다
    - 공유 변수 사용을 조심해야함
- JSP도 서블릿으로 변환 되어서 사용
- 동시 요청을 위한 멀티 쓰레드 처리 자원 <- 제일 중요함

## 동시 요청 - 멀티 쓰레드
- 쓰레드
    - 애플리케이션 코드 하나하나 순차적을 실행하는 것이 쓰레드
    - 자바 메인 메서드를 처음 실행하면 main이라는 이름의 쓰레드
    - 쓰레드가 없다면 자바 애플리케이션 실행이 불간으
    - 쓰레드는 한번에 하나의 코드 라인만 수행
    - 동시 처리가 필요하면 쓰레드를 추가로 생성
    - 생성 제한이 없어서 임계점을 넘어서 죽어버리는 경우 생김
- 쓰레드 풀
    - 쓰레드를 미리 생성하고 보관하고 있는 보관함
    - 놀고 있는 쓰레드를 사용했다가 종료되면 쓰레드를 죽이는 것이 아니라 다시 쓰레드 풀에 반납
    - 임계점을 넘지 않는 범위에서 미리 쓰레드를 생성해놓고 사용 -> 쓰레드 최대치 관리 -> 톰캣은 기본 200개 관리 
    - 쓰레드를 미리 생성하기 떄문에 종료하는 비용(CPU)이 절약되고, 응답 시간이 빠름
    - 생성 가능한 쓰레드의 최대치가 있으므로 너무 많은 요청이 들어와도 기존 요청은 안전하게 처리 가능하다.

## 최대 쓰레드 상황별 대응
- WAS의 주요 튜닝 포인트는 최대 쓰레드 수
- 최대 쓰레드를 너무 낮게 설정하면 클라이언트 응답 지연 -> CPU의 너무 적은 부분만 사용
    - AWS 서버를 증설하는 행위는 매우 비효율적임 -> 설정을 잘하자
- 최대 쓰레드를 너무 높게 설정하면 동시 요청이 많을 경우 CPU, 메모리 리소스 임계점 초과로 서버다운
- 장애 발생시
    - 클라우드면 일단 서버부터 늘리고, 이후에 튜닝
    - 클라우드가 아니라면 열심히 튜닝해야함

## 쓰레드 풀의 적정 숫자
- 애플리케이션 로직의 복잡도, CPU, 메모리 IO 리소스 상황에 따라 모두 다르다
- 성능 테스트
    - 최대한 실제 서비스와 유사하게 성능 테스트를 시도
    - 툴 : 아파치 ab, 제이미터, nGrinder

## WAS의 멀티 쓰레드 지원 -> 핵심
- 멀티 쓰레드에 대한 부분은 WAS가 처리
- 개발자는 멀티 쓰레드 관련 코드를 신경쓰지 않아도 된다 -> 최대수 튜닝 설정만 잘하면 된다.
- 멀티 쓰레드 환경이므로 싱글톤 객체(서블릿, 스프링 빈)는 주의해서 사용해야 한다.

## SSR
- 서버에서 최종 HTML을 생성해서 클라이언트에 전달
- 주로 정적 화면에서 사용
- JSP, 타임리프 -> 백엔드 개발자
## CSR
- HTML 결과를 자바스크립트를 사용해 웹 브라우저에서 동적을 생성해서 적용
- 주로 동적인 화면에서 사용, 웹 환경을 마치 앱 처럼 필요한 부분만 변경가능
- React, Vue.js -> 웹 프론트엔드 개발자

- SSR을 사용하더라도, 자바 스크립트를 사용해서 화면 일부를 동적으로 변경 가능

## 과정
1. HTML 요청 -> HTML 반환 (내용은 없고 자바스크립트 링크를 반환)
2. 웹 브라우저가 자바스크립트 요청 -> 자바스크립트 클라이언트 로직, HTML 렌더링 코드 반환
3. HTTP API - 데이터 요청 -> JSON으로 데이터 전달
4. 웹 브라우저에서 자바스크립트로 HTML 렌더링