# CDN이란 무엇인가?
- 콘텐츠 전송 네트워크(Content Delivery Network)은 전 세계에 분산된 서버 네트워크
- 사용자와 물리적으로 가까운 위치에서 정적 컨텐츠(혹은 동적)를 제공하며 서버 과부하를 방지하고 통신 지연을 단축한다.
- 통신에 참여하는 호스트 간에 중간 서버를 두어 성능을 향상한다.
- 대표적으로 CloudFront, CloudFlare
- 사용자와 물리적으로 가까운 위치에 캐싱할 때 ISP(Internet Service Provider, 인터넷 서비스 제공자)의 네트워크를 활용한다 -> 즉, ISP 내부에(= ISP의 데이터센터에) CDN을 배치한다.
    - 사용자의 요청이 ISP 내부에서 해결되고 네트워크 트래픽을 최적화할 수 있다.

## CDN에서 PUSH와 PULLL 방식의 차이점은?
- PUSH 방식
    - 원본 서버가 콘텐츠를 미리 CDN 서버로 전달하는 방식
    - 적절한 시기에 정확한 컨텐츠를 제공할 수 있다.
    - 하지만 지속적인 업데이트가 필요함
- PULL 방식
    - CDN서버가 원본 서버로 요청을 보내 컨텐츠를 가져오는 방식
    - 클라이언트가 요청을 보내는 경우, CDN에 원하는 컨텐츠가 없다면 원본 서버로부터 컨텐츠를 가져와서 업데이트 하는 방식으로 동작한다.
    - 초기 요청에서는 원본 서버에서 컨텐츠를 가져오는 작업을 수행하야 하므로 응답 속도가 저하될 수 있음.

## CDN 사용시 고려사항
- 크게 비용, 만료 시간, CDN 장애대응, 컨텐츠 무효화
- CDN은 주로 제 3 사업자(클라우드 서비스 등)에게 비용을 지불하고 사용한다.
그래서 비용 대비 효과를 고려하여 비판적으로 도입하고, 성능 향상이 필요한 컨텐츠만 캐싱하는 등 비용을 절약해야함
- 장애 발생시 대응 -> CDN에서 컨텐츠를 응답할 수 없는 경우, 클라이언트에서 원본 서버로부터 직접 컨텐츠를 가져오게 하는 등의 방법
- 컨텐츠 무효화 방법 -> 오브젝트 버저닝을 사용하거나, CDN에서 제공되는 API를 활용하거나

## CDN 장점
- CDN이 이미 캐싱한 정보를 바로 유저에게 전달하기 때문에 서버에 가해지는 부하가 적다.
- 원본서버에 유저의 직접적인 접속을 받고 있지 않고 CDN이 앞에서 처리해주면서 자연스럽게 보호막 역할을 수행할 수 있게 됨 - L4레이어 수준의 공격도 CDN 서버거 분산해서 처리해준다. - 최근에는 CDN 서버 위에 L7 레이어 웹 방어벽을 설치해서 고 수준의 공격도 처리

## Time To Live(TTL)
- 모든 캐시에 적용
- 캐시가 얼만큼 컨텐츠를 가지고 있어야 하는가? CDN에서 TTL 설정 만큼 컨텐츠를 보관한다.
- 재요청이 있을시 원본서버에 갱신(업데이트)가 있는지 확인하고 없다면 유저에게 반환, 있다면 원본서버에서 컨텐츠를 내려받아 캐시를 갱신.

## Cache Key
- 엣지 서버가 굉장히 많은 컨텐츠를 가지고 있기 때문에 빨리 찾기 위해서는 색인(인덱스)가 필요한데 그 색인에 해당된다.
- 도메인, URL, Query String 등을 사용
- 추가적으로 해당 유저의 접속 국가 같은 정보를 담을 수도 있다.
## Purge and eviction
- TTL이 지켜지지 않는 경우가 2가지 있다.
    - Purge : 서비스 개발자의 필요에 의해서 컨텐츠를 제거하는 경우(새로운 컨텐츠로 변경된 경우 기존 컨텐츠의 서빙을 막고 새로운 컨텐츠로 캐싱하기 위해)
    - Eviction : 엣지 서버가 많은 부하를 받는 경우 인기가 없는 컨텐츠부터 지워서 리소스를 확보
## Client cache
- 캐시는 서버측, 클라이언트측 두 가지가 존재하며 트러블 슈팅시에 이게 서버의 캐싱 오류인지 클라이언트의 캐싱 오류인지 혼동하면 안된다.