# 동시성과 병렬성
## 동시성(Concurrency)
동시성이란 이름퍼럼 실제로 여러 작업을 동시에 수행하는 것이 아니라, 논리적으로 동시에 실행되는 것처럼 보이게 만드는 개념이다. 단일 코어를 기준으로 시간 분할을 통해 여러 스레드를 번갈아 가며 작업을 수행함으로써, 마치 동시에 여러 작업이 처리되는 것처럼 보이게 한다.

사용자의 입력을 기다리거나, 네트워크 요청, 파일의 입출력 등의 I/O 작업 시에는 CPU가 유휴 상태로 대기하게 된다.
이때 CPU가 아무일도 하지 않고 대기 하는 대신, 컨택스트 스위칭(문맥 교환)을 통해 다른 스레드의 작업을 처리할 수 있다. 이러한 특성 덕분에 서버는 여러 클라이언트의 요청을 동시에 처리할 수 있어 효율적이다.
다만, 동시성 환경을 신중하게 고려하지 않으면 여러 스레드를 사용하면서 Deadlock(교착 상태), Race Condition(경쟁 상태), Starvation(기아 상태) 등의 문제가 발생할 수 있다. 이러한 문제를 해결하기 위해서는 동기화 기법을 사용하여 스레드 간의 상호작용을 조절해야 한다.

## 병렬성(Parallelism)
병렬성이란 물리적으로 동일한 시간에 여러 작업을 독립적으로 수행하는 것을 의미한다. 여러 개의 코어(멀티 코어)가 각각 독립된 스레드의 작업을 동시에 처리함으로써, 실제로 여러 작업이 동시에 실행된다.
동시성과는 달리, 하나의 코어가 여러 스레드를 번갈아 가며 처리할 필요 없이, 각 코어에서 독립적으로 작업을 실행한다.

독립적인 하위 작업으로 나눌 수 있는 계산과 같은 작업을 여러 코어에 분산함으로써, 작업 완료 시간을 최소화할 수 있어 고성능 컴퓨터에 이상적이다. 하지만 병렬 처리는 데이터나 리소스를 공유할 때 작업 간 동기화가 필요한 경우가 많아, 이러한 동기화로 인해 상당한 오버헤드가 발생할 수 있다. 따라서 병렬 처리를 사용할 때는 작업 간의 의존성을 최소화하고, 동기화 비용을 고려하여 설계해야 한다.

## 동시성과 병렬성의 차이점 표
| 구분       | 동시성(Concurrency)                          | 병렬성(Parallelism)                          |
|------------|---------------------------------------------|---------------------------------------------|
| 실행 방식  | 논리적으로 동시에 실행되는 것처럼 보이게 함 | 물리적으로 동시에 실행됨                  |
| 작업 처리  | 단일 코어에서 시간 분할로 여러 스레드 처리 | 멀티 코어에서 독립적으로 작업 처리         |    
| 스레드 관리 | 컨택스트 스위칭을 통해 스레드 전환         | 각 코어에서 독립적으로 스레드 실행         |
| 주요 사용   | I/O 작업, 사용자 입력 대기 등               | 계산 집약적인 작업, 대규모 데이터 처리 등 |
| 동기화 필요 | 스레드 간 상호작용 조절 필요          | 데이터나 리소스 공유 시 동기화 필요     |
| 오버헤드    | 상대적으로 낮음                            | 동기화로 인한 오버헤드 발생 가능  |
| 예시       | 웹 서버, GUI 애플리케이션 등                | 대규모 데이터 처리, 과학적 계산 등 |

## 실무에서는 어떻게 사용될까?
### 동시성 실무 사용
I/O 대기 시간 동안 CPU를 놀리지 않고 다른 작업을 처리
- **웹 서버**: 클라이언트의 요청을 처리하는 동안 다른 클라이언트의 요청을 동시에 처리할 수 있다. 
    - 예 : Node.js, Nginx, SpringMVC(Thread Pool 사용)
    - 한 요청이 DB 조회나 API 호출로 대기하는 동안 다른 요청을 처리
- 채팅/메신저 서비스 
    - WebSocket을 통해 연결을 유지하면서 여러 클라이언트의 메시지를 동시에 처리
- GUI 애플리케이션
    - 화면 이벤트 처리와 백그라운드 작업을 동시에 수행하여 사용자 경험 향상
- 비동기 처리(Async)
    - Java의 CompletableFuture, Kotlin의 Coroutines, JavaScript의 Promise 등을 사용하여 비동기적으로 작업을 처리
> 동시성은 "CPU를 효율적으로 사용하는 구조"를 만든느데 중점을 둔다. 보통 Thread Pool + 이벤트 루프 조합이 많이 사용된다.

### 병렬성 실무 사용
CPU 코어를 최대한 활용해 동시에 계산
- **대규모 데이터 처리**: MapReduce, Apache Spark 등에서 데이터 집계, 통계 연산을 여러 노드/코어에 분산
- 멀티 스레드 연산
    - Java Parallel Stream(list.parallelStream()), CPU-bound 작업(예: 이미지 처리, 압축, 암호화등) 최적화
- 과학적 계산
    - AI/ML 모델 학습, 시뮬레이션 등에서 대규모 연산 병렬 처리를 통해 계산 속도 향상
- GPU 병렬 처리
    - CUDA, OpenCL 등을 사용하여 수천 개의 스레드가 동시에 실행되는 병렬 연산 수행
> 병렬성은 "계산을 분산하여 처리 속도를 높이는 구조"를 만든느데 중점을 둔다. 보통 Fork/Join Pool, ExecutorService, OpenMP 등을 사용한다.

## 동시성과 병렬성의 조합
예시 : 웹 서버(동시성)에서 여러 요청을 동시에 처리하면서 내부에서 대규모 데이터 연산은 병렬 처리로 분산
- Spring WebFlux와 병렬 스트림을 조합하여 사용
- Node.js: 비동기 이벤트 루프를 사용하여 동시성 처리, 데이터 처리 시 Worker Threads를 사용하여 병렬 처리
- Python: asyncio를 사용하여 동시성 처리, multiprocessing 모듈을 사용하여 병렬 처리

## 면접에서 나올 수 있는 질문과 답변

**Q1. 동시성과 병렬성의 차이는 무엇인가요?**  
A1. 동시성은 하나의 코어에서 여러 작업을 시간 분할로 번갈아 처리해 논리적으로 동시에 실행되는 것처럼 보이게 하는 반면, 병렬성은 멀티 코어에서 여러 작업을 실제로 동시에 수행하는 것입니다. 동시성은 주로 I/O-bound 작업에, 병렬성은 CPU-bound 작업에 적합합니다.

**Q2. I/O bound 작업과 CPU bound 작업은 어떻게 처리하는 것이 효율적인가요?**  
A2. I/O bound 작업은 동시성으로 처리해 CPU가 대기하는 시간을 줄이고, CPU bound 작업은 병렬성으로 여러 코어에 작업을 분산해 처리 속도를 높이는 것이 효율적입니다. 예를 들어, 웹 서버는 비동기 I/O로 동시성 처리하고, 이미지 처리 같은 계산 작업은 병렬 처리합니다.

**Q3. 병렬 처리 시 성능 저하가 발생하는 원인은 무엇인가요?**  
A3. 병렬 처리 중 데이터 공유로 인한 동기화 비용, 작업 간 의존성, 컨텍스트 스위칭 오버헤드 등이 성능 저하를 일으킵니다. 따라서 작업을 독립적으로 설계하고 동기화 비용을 최소화하는 것이 중요합니다.

**Q4. Spring에서 비동기 및 병렬 처리는 어떻게 구현할 수 있나요?**  
A4. Spring에서는 @Async 어노테이션과 ThreadPoolTaskExecutor를 사용해 비동기 처리를 구현할 수 있고, 병렬 처리는 Java의 Parallel Stream이나 ForkJoinPool, CompletableFuture를 활용해 여러 코어에서 작업을 분산 처리합니다.

**Q5. 동시성과 병렬성을 함께 사용하는 사례를 설명해 주세요.**  
A5. 웹 서버에서 클라이언트 요청을 비동기 논블로킹 I/O로 동시성 처리하면서, 내부에서 대규모 데이터 분석은 병렬 스트림이나 멀티스레드로 병렬 처리하는 경우가 대표적입니다. 예를 들어, Spring WebFlux와 병렬 스트림을 조합해 사용합니다.