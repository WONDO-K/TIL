# @Value 어노테이션 주의점
- @Value는 설정 파일에 설정한 값을 주입할 수 있는 어노테이션이다.
    - 첫 번째로 주의할 부분은 주입 시점.
        - 대상 컴포넌트가 스프링 빈으로 등록되고 의존 관계를 주입할 때 동작한다.
        - 따라서 환경 변수를 주입받는 대상 클래스에 @Component 어노테이션을 붙여주지 않는다면 해당 클래스는 컴포넌트 스캔의 대상이 되지 않아 스프링 빈으로 등록되지 않고, @Value 어노테이션 또한 동작하지 않는다.
    - 상황에 따라 적절한 주입 방식을 선택해야 한다.
        - 빈을 주입받을 때와 마찬가지로 @Value 어노테이션을 사용할 때도 필드 주입, 생성자 주입, setter 주입 등의 방식을 사용할 수 있다.
        - 따라서 이들의 장단점을 비교하고, 상황에 따라 적절한 주입 방식을 선택해야 한다.
    - 프로퍼티 파일의 경로와 스코프를 확인해야 한다.
        - application.yml 이 클래스 패스에 존재해야 하고, 프로퍼티 파일이 여러개일 경우 우선순위를 고려해야 한다.
## @ConfigurationProperties 어노테이션과의 차이점ㄴ
- 스프링의 프로퍼티 파일의 값은 Enviroment에 등록된다. 
두 어노테이션 모두 이 값을 불러올 수 있다는 공통점이 있다.
- 단, @Value의 경우에는 단일 값을 주입받기 위해 사용하며, RelaxedBinding이 적용되지 않는다.
    - RelaxedBinding란? : 프로퍼티 이름이 조금 달라도 유연하게 바인딩을 시켜주는 규칙을 의미
- 반면 @ConfigurationProperties는 프로퍼티에 있는 값을 클래스로 바인딩하기 위해 사용한다.
한 번에 여러 값을 바인딩 받을 수 있으며 RelaxedBinding을 적용한다. 

## @DynamicPropertySource와 테스트 환경의 동적 프로퍼티 주입

- `@DynamicPropertySource`는 테스트 환경에서 필요한 설정 값을 동적으로 주입할 수 있도록 지원하는 어노테이션이다.
- 테스트 클래스 내부에 `@DynamicPropertySource`를 선언하고, `DynamicPropertyRegistry`를 통해 값을 설정하면 테스트 컨텍스트에 해당 값이 주입된다.

```java
@DynamicPropertySource
static void overrideProps(DynamicPropertyRegistry registry) {
    registry.add("jwt.secret", () -> "test-secret");
}
```

### 사용 이유 및 장점

1. **테스트 환경의 독립성 확보**
   - 운영 환경 설정을 그대로 사용하는 것은 위험하며, 테스트 목적에 맞는 고립된 환경을 만들어야 한다.
   - 테스트 전용 DB, 시크릿 키, API 주소 등을 설정하여 실환경 자원에 영향을 주지 않는다.

2. **유연한 설정값 제어**
   - 테스트 컨테이너, 랜덤 포트, 동적 토큰 등 코드로 결정되는 설정값을 주입할 수 있다.
   - 정적 프로퍼티 파일보다 더 유연하게 환경을 구성할 수 있다.

3. **테스트 간 충돌 방지**
   - 각 테스트마다 다른 설정값을 가질 수 있어 데이터 간섭이나 자원 충돌을 방지할 수 있다.

### 면접에서는 이렇게도 나올 수 있어요

> "SpringBootTest 환경에서 실 DB 접근을 피하고 싶다면 어떻게 하시겠어요?"

- `@DynamicPropertySource`와 테스트 컨테이너를 활용하여 테스트 실행 시점에 전용 DB를 동적으로 할당하고, 연결 정보를 프로퍼티로 주입하여 독립적인 테스트 환경을 구성할 수 있다고 설명하면 좋다.