# JWT
- JWT(Json Web Token)은 통신 정보를 JSON 형식을 사용하여 안전하게 전송하기 위해 사용된다.
- 토큰 자체에 정보가 포함되어 있는 클레임 기반의 토큰
- 일반적인 애플리케이션에서 주로 인증/인가를 구현하기 위해 사용한다.
- 헤더, 페이로드, 시그니처로 구성되어 있다
    - 헤더 : 토큰의 암호화 알고리즘이나 타입
    - 페이로드 : 데이터(만료일, 사용자 정보 등)
    - 시그니처 : 헤더와 페이로드가 변조되지 안항ㅆ는지 판단하기 위해 사용
    헤더와 페이로드를 비밀 키를 사용하여 헤더에 명시된 암호화 알고리즘으로 암호화하면 시그니처가 된다.
## 특징
- JWT를 사용하여 인가를 구현하면 클레임 기반 토큰 특성 상 세션 기반 인증에 비해서 사용자 정보를 조회하기 위한 추가적인 작업이 필요하지 않다.
- 서버 상태를 관리하지 않기 떄문에 서버가 이중화된 환경에서도 사용자의 로그인 정보를 일관성 있게 관리할 수 있다.(세션 불일치 문제가 발생하지 않는다.)
## 주의사항
- JWT는 디코딩이 쉽기 때문에 Base64로 디코딩하면 페이로드를 확인할 수 있다. -> 민감한 정보는 담지 않도록 한다.
- 시크릿 키의 복잡도가 낮은 경우, 무작위 공격에 노출될 수 있다. -> 강력한 시크릿 키 사용 권장
- 시크릿 키는 유출되면 안된다.
    - 아주 짧은 문자열, 단어 등으로 하는 경우가 있는데 -> 조진다.
    - 유튜브 강의보고 따라서 q1w2e3r4, secret 이렇게 설정해버리면 -> 때려맞추기 너무나 쉽다 -> 조진다.
        - 대처법
        - 아주 긴 문자열로 작성한다.
        - JWT 생성용/검증용 키를 2개 사용한다. -> 라이브러리 잘 찾아보자
- 탈취에 유의해야한다. -> JWT는 stateless 특성 상 사용정지를 할 수 없음
    - JWT 저장공간 확보 (훔치기 어렵게)
    - 블랙리스트 운영 -> 이렇게 하면 Session 방식과 다를바가 없어져서 JWT를 사용하는 이점이 사라짐
    - 리프레쉬 토큰 도입 여부
    - Refresh Token Rotation(RTR) -> 리프래쉬 토큰도 탈취 위험이 있기 때문에 리프래쉬도 1회용으로 사용한다. -> 라이브러리 찾아보기
    - 탈취 감지 및 대응에 대한 고민이 필요함
- 토큰의 잦은 갱신이 사용자 경험을 저해하는지 고려해야함.
    - 예를 들어 유저가 3시간 동안 게시글을 작성하고 게시했지만 JWT가 만료되어 작성한 게시글이 사라진다면?
    - 슬라이딩 세션과 같은 전략을 고민해봐야 한다.
- JWT none 알고리즘 공격을 유의해야 한다.
    - 공격자가 헤더에 명시된 알고리즘을 none으로 변경하여, 페이로드가 변조되었음에도 시그니처 검증을 우회하는 상황이 생김
    - 공격 예방 라이브러리 혹은 none 알고리즘은 비교적 약한 알고리즘이기 떄문에 적절한 필터링을 하는 등의 주의가 필요함

## Sliding Sessions & Access Token
- 보안성과 편의성을 모두 잡기 위해 나온 전략
- 세션을 지속적으로 이용하는 유저에게 자동으로 만료 기한을 늘려주는 방법
### 구현방법
- 주로 AccessToken을 가진 클라이언트의 요청에 대해 서버가 새로운 토큰을 발급해주는 방법을 사용
- 매 요청마다 새로운 토큰을 내려주는 것도 가능하지만, 글을 작성하다가 인증이 만료되는 거지 같은 경우를 막기 위해 글 작성을 시작할 때 발급해준다거나, 쇼핑몰에서 장바구니에 아이템을 담는 경우에 발급해주는 등의 전략을 사용하는 것도 괜찮은 방법
- 클라이언트가 토큰의 iat(토큰 발급 시간)속성을 참조해서 갱신 요청을 하는 방법도 있음
#### 장점
- 사용자가 로그인을 자주 할 필요가 없다.
- 글을 작성하거나 결제를 하는 등의 세션 유지가 필요한 순간에 세션이 만료되는 문제를 방지 할 수 있다.
#### 단점
- 접속이 주로 단발성으로 이루어지는 서비스의 경우 Sliding Sessions 전략의 효과가 크지 않다.
- 긴 만료 시간을 갖는 AccessToken을 사용하는 경우 로그인을 전혀 하지 않아도 되는 경우가 발생한다.

## Sliding Sessions 전략과 함께 AccessToken과 RefreshToken을 사용
- AccessToken의 Sliding Sessions 전략이 AccessToken 자체의 만료 기간을 늘려주었다면, 이 전략은 RefreshToken의 만료 기간을 늘려준다.
- RefreshToken의 만료 기간이 늘어나기 떄문에 AccessToken + Sliding Sessions 전력처럼 빈번하게 만료 기간을 연장할 필요가 없고 사용자의 유효 허용 기간을 RefreshToken 기간에 근접하게 만들어준다.
- 다만 사용자가 접속을 뜸하게 하는 경우도 RefreshToken의 만료기간이 늘어나기 때문에 탈취되는 경우에 지속적으로 이용이 가능하다.
    - 이를 막기 위해 인증이 강력히 요구되는 영역에서 비밀번호를 재차 물어보거나
    - 비밀번호 변경 등의 이벤트 발생시 강제로 RefreshToken를 만료처리 시켜주는 방법도 있음
#### 장점
- RefreshToken의 만료 기간에 대한 제약을 받지 않는다.
- 글 작성, 결제 등의 세션 유지가 필요한 순간에 세션이 만료되는 문제를 방지
#### 단점
- 서버에서 강제로 RefreshToken를 만료하지 않는 한 지속적으로 사용할 수 있게 된다.

# SESSION과 JWT의 차이
세션 방식은 입장권 발급 목록을 조회하여 발급 여부를 확인하는 과정을 거쳐야 인증이 이루어지지만
JWT의 경우 입장권(토큰)에 세션 보다 더 많은 정보들이 담겨있기 때문에 입장권 그 자체만 보고 인증을 처리해줄 수 있다.(ex : 이름, 이메일, 발급일, 유효기간) 