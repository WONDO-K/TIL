# 데이터베이스 시스템 동시성 제어 방법
대표적인 동시성 제어 방식에는 MVCC(Multi-Version Concurrency Control)와 Lock-Based Concurrency Control이 있다.

## MVCC(Multi-Version Concurrency Control)
MVCC는 데이터의 여러 버전을 관리하여, 트랜잭션이 동시에 데이터를 읽고 쓸 수 있도록 하는 방식이다. 각 트랜잭션은 시작 시점의 일관된 스냅샷을 기반으로 데이터를 읽으므로, 다른 트랜잭션의 변경 사항에 영향을 받지 않고 독립적으로 작업할 수 있다.

읽기 작업 시 잠금을 사용하지 않아 높은 동시성을 제공하며, 읽기 작업이 잠금에 의해 지연되지 않아 읽기 중심의 애플리케이션에서 우수한 성능을 보인다. 또한, 읽기와 쓰기 작업 간의 충돌이 줄어든다.

하지만 여러 버전의 데이터를 유지해야 하므로 저장 공간이 더 많이 필요할 수 있다.

대부분의 MVCC 구현은 'Repeatable Read' 격리 수준에서 동작해, 같은 트랜잭션 내에서는 동일한 데이터를 반복 조회하더라도 항상 동일한 결과를 보장한다.

삭제된 레코드는 즉시 제거되지 않고 '숨김 처리'되어, 해당 레코드를 참조 중인 트랜잭션이 모두 종료될 때까지 내부적으로 유지된다. 이 덕분에 트랜잭션 간 충돌 없이 읽기 작업이 가능하다.

## Lock-Based Concurrency Control
Lock-Based 방식은 데이터에 접근할 때 잠금(Lock)을 사용하여 동시성을 제어한다. 트랜잭션이 데이터를 읽거나 수정할 때 해당 데이터에 잠금을 걸어, 다른 트랜잭션의 접근을 제한한다. 이를 통해 데이터의 일관성과 무결성을 보장한다.

읽기 작업은 공유 잠금, 쓰기 작업은 배타 잠금을 사용한다. 많은 트랜잭션이 동일한 데이터에 접근할 경우 성능 저하가 발생할 수 있으며, 잘못된 잠금 순서나 설계로 인해 교착상태(Deadlock)이 발생할 위험이 있다.

대부분의 Lock-Based 시스템은 2단계 잠금 기법(2PL: Two Phase Locking)을 사용한다. 트랜잭션은 모든 필요한 잠금을 얻은 후 작업을 수행하고, 이후 잠금을 한 번에 해제한다. 이는 일관성을 보장하지만 교착 상태 발생 위험이 존재한다.

## MVCC와 Lock-Based Concurrency Control, 어떤 방식을 선택해야 할까?
실제 데이터베이스 시스템(예: MySQL의 InnoDB)은 MVCC와 Lock-Based 방식의 장점을 결합하여 동시성 제어를 최적화한다. 읽기 트랜잭션은 MVCC를 이용해 일관된 스냅샷을 기반으로 데이터를 읽으므로 잠금을 최소화하고 높은 동시성을 유지할 수 있다. 쓰기 트랜잭션은 잠금을 사용하여 데이터의 일관성과 무결성을 보장하면서, 데이터 충돌을 방지한다.

**핵심 정리**

- **읽기 작업이 많고 변경이 적은 시스템**: MVCC가 유리함 (예: 게시판, 로그 분석 시스템)
- **데이터 일관성과 정확한 동기화가 중요한 시스템**: Lock-Based 방식이 적합 (예: 금융 거래 시스템)

### 🔍 동시성 제어 방식 비교

| 항목 | MVCC | Lock-Based |
|------|------|------------|
| 동작 방식 | 데이터 버전 관리 | 잠금으로 접근 제한 |
| 읽기 성능 | 높음 (잠금 없음) | 낮을 수 있음 (공유 잠금) |
| 쓰기 충돌 | 버전 병합 불가 시 충돌 | 잠금 충돌 발생 |
| 저장 공간 | 다소 많이 사용 | 상대적으로 적음 |
| 교착 상태 | 없음 | 발생 가능 |
| 적합한 환경 | 읽기 위주 시스템 | 정합성 높은 처리 요구 시스템 |
